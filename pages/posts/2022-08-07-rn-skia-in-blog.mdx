import { parse, parseISO } from "date-fns"
import { PostLayout } from "../../components/PostLayout"
import { ImageWrapper } from "../../components/atoms/ImageWrapper"
import { View, Text, ActivityIndicator } from "react-native"
import { WithSkiaWeb } from "@shopify/react-native-skia/lib/module/web"

export const meta = {
  title: "ãƒ–ãƒ­ã‚°ã«react-native-skiaã‚’å°å…¥ã—ã¾ã—ãŸğŸ¨",
  tagNames: ["react-native-skia", "next.js", "react-native", "skia", "react-native-web"],
  color1: "#4CC8F0",
  color2: "#3B8FFD",
  createdAt: parse(
    "2022-08-07 11:12:00 +09:00",
    "yyyy-MM-dd HH:mm:ss XXX",
    new Date(),
  ),
  author: "@gaishimo",
  description: "2Dã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’React Nativeã§æ‰±ã†ãŸã‚ã®react-native-skiaã‚’å½“ãƒ–ãƒ­ã‚°ã«å°å…¥ã—ã¾ã—ãŸ",
  imagePath: "/posts/2022-08-07-rn-skia-in-blog/image.png",
  lastUpdatedAt: parse(
    "2022-08-08 09:15:00 +09:00",
    "yyyy-MM-dd HH:mm:ss XXX",
    new Date(),
  ),
}

export const headlines = [
  { title: "ãƒ–ãƒ­ã‚°ã¸ã®å°å…¥" },
  { title: "å®Ÿéš›ã«react-native-skiaã§æç”»ã—ã¦ã¿ã‚‹" },
  { title: "æ‰€æ„Ÿ" },
]

export default props => (
  <PostLayout headlines={headlines} meta={meta}>
    {props.children}
  </PostLayout>
)


[react-native-skia](https://github.com/Shopify/react-native-skia)ãŒExpo Goã¨Webã§ã‚µãƒãƒ¼ãƒˆã•ã‚ŒãŸãã†ã§ã™ã€‚

> React Native Skia is now supported in Expo Go and on web. Skia is a high-performance 2D graphics library used by Chrome, among many other great tools, and React Native Skia provides an idiomatic React API for using Skia in your apps. This library raises the ceiling over what you can do in React Native â€” itâ€™s truly a â€œgame changerâ€ for producing performant visual effects with React. React Native Skia is built by William Candillon and Christian Falch with support from Shopify.

[Expo SDK 46. | by Brent Vatne | Aug, 2022 | Exposition](https://blog.expo.dev/expo-sdk-46-c2a1655f63f7)


[Skia](https://skia.org/)ã¯GoogleãŒé–‹ç™ºã—ã¦ã„ã‚‹OSSã®2Dã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã‚„Androidç­‰ã€æ§˜ã€…ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚Flutterã¯UIã®æç”»ã‚¨ãƒ³ã‚¸ãƒ³ã«Skiaã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚

React Nativeã§ã¯2Dæç”»ã‚’ã—ãŸã„å ´åˆã€æœ‰åŠ›ãªæ‰‹æ®µãŒSVGã—ã‹ãªãè¡¨ç¾åŠ›ã«é™ç•ŒãŒã‚ã‚Šã¾ã—ãŸã€‚ä¾‹ãˆã°[ã‚·ãƒ£ãƒ‰ã‚¦ã‚„ã¼ã‹ã—ã¨ã„ã£ãŸåŠ¹æœãŒä½¿ãˆãªã‹ã£ãŸã‚Š](https://github.com/react-native-svg/react-native-svg/issues/150)ã™ã‚‹ã®ã‚‚ãã®ä¸€ä¾‹ã§ã™ã€‚SVGã‚’åˆ©ç”¨ã—ãŸå ´åˆæç”»ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«ã‚‚èª²é¡ŒãŒã‚ã‚Šã¾ã—ãŸã€‚

ã“ã‚Œã«å¯¾ã—[react-native-skia](https://github.com/Shopify/react-native-skia)ãŒæä¾›ã•ã‚ŒãŸã“ã¨ã«ã‚ˆã‚Šã€React Nativeã§ã•ã¾ã–ã¾ãª2Dæç”»ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚React Nativeã®æ–°ã—ã„ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã‚ã‚‹JSIã‚’åˆ©ç”¨ã—ã¦ãŠã‚Šãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚‚æœŸå¾…ã§ããã†ã§ã™ã€‚ã¾ãŸFlutterã®APIã¨100ï¼…äº’æ›ã«ãªã£ã¦ã„ã‚‹ãã†ã§ã™ã€‚Webç‰ˆã§ã¯Flutterã¨åŒæ§˜ã«CanvasKit (WASM)ãŒåˆ©ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®ã‚ãŸã‚Šã‚‚Flutterã¨åŒã˜APIã«ã—ã¦ã„ã‚‹ç†ç”±ãŒã‚ã‚Šãã†ã§ã™ã€‚

ä»¥ä¸‹ã¯react-native-skiaã®è¨˜äº‹ãƒ»å‹•ç”»ãƒ»é–‹ç™ºè€…ã®Twitterã‚¢ã‚«ã‚¦ãƒ³ãƒˆç­‰ã®ãƒªãƒ³ã‚¯ã§ã™ã€‚

- [React Native Skiaâ€”For Us, For You, and For Fun â€” Mobile (2022)](https://shopify.engineering/react-native-skia-shopify)
- [Pedal to the Metal - YouTube](https://www.youtube.com/watch?v=uvLQ5f3KDXk)
- [React Native Skia - YouTube](https://www.youtube.com/watch?v=EHxEX78alZE&t=1541s)
- [Christian Falchï¼ˆ@chrfalch) / Twitter](https://twitter.com/chrfalch)
- [William Candillonï¼ˆ@wcandillon) / Twitter](https://twitter.com/wcandillon)
- [Shopify Engineeringï¼ˆ@ShopifyEngï¼‰ / Twitter](https://twitter.com/ShopifyEng)


## ãƒ–ãƒ­ã‚°ã¸ã®å°å…¥


å½“ãƒ–ãƒ­ã‚°ã¯react-native-webã‚’å°å…¥ã—ã¦ã„ã‚‹ã®ã§è¨˜äº‹ã®Markdownå†…ã§React Nativeã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™([ä»¥å‰ã®è¨˜äº‹: "å½“ãƒ–ãƒ­ã‚°ã«React Native for Webã‚’å°å…¥ã—ã¾ã—ãŸ"](https://blog.omoidasu.dev/posts/2021-09-24-blog-rn-web) )ã€‚ã“ã‚Œã«åŠ ãˆSkiaã§ã®2Dæç”»ãŒä½¿ãˆã‚Œã°è¨˜äº‹å†…ã§æ›´ã«è‰²ã€…ãªè¡¨ç¾ãŒã§ããã†ãªã®ã§æ—©é€Ÿå°å…¥ã—ã¦ã¿ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚


Webã§ã®react-native-skiaã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ–¹æ³•ã¯ä»¥ä¸‹ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«å¾“ã„ã¾ã™ã€‚


[Web Support | React Native Skia](https://shopify.github.io/react-native-skia/docs/getting-started/web)


ã¾ãšãƒ©ã‚¤ãƒ–ãƒ©ãƒªè‡ªä½“ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```bash
yarn add @shopify/react-native-skia
```

ãã®å¾ŒWebPackã®è¨­å®šãŒå¿…è¦ã«ãªã‚Šã¾ã™ãŒã€ã“ã®ãƒ–ãƒ­ã‚°ã¯next.jsã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ãŸã‚next.config.jsã§è¨­å®šã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚


```js
const configs = {
  webpack: config => {
    config.resolve.alias = {
      ...(config.resolve.alias || {}),
      // Transform all direct `react-native` imports to `react-native-web`
      "react-native$": "react-native-web",
      // (1)
      react: path.resolve(__dirname, "./node_modules/react"),
      "react-native-web": path.resolve(
        __dirname,
        "./node_modules/react-native-web",
      ),
    }
    // (2)
    config.resolve.fallback = {
      fs: false,
      path: false,
    }
    // (3)
    config.plugins = [
      ...config.plugins,
      new CopyPlugin({
        patterns: [
          {
            from: "node_modules/canvaskit-wasm/bin/full/canvaskit.wasm",
            to: "static/chunks/pages/posts/canvaskit.wasm",
          },
        ],
      }),
    ]
    // (4)
    config.externals = {
      ...config.externals,
      "react-native-reanimated": "require('react-native-reanimated')",
      "react-native-reanimated/lib/reanimated2/core":
        "require('react-native-reanimated/lib/reanimated2/core')",
    }
    return config
  },
}
```

(1)ã®`resolve.alias`ã®éƒ¨åˆ†ã¯reactã®æ··åœ¨ã«ã‚ˆã‚Š`"Hooks can only be called inside the body of a function component"`ã¨ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ãŸã‚ãã®å›é¿ã®ãŸã‚ã§ã™ã€‚

(2)ã®`config.resolve.fallback`ã¯ã€canvaskit-wasmã§`cannot resolve fs`ã®ã‚¨ãƒ©ãƒ¼ã‚’å›é¿ã™ã‚‹ãŸã‚ã®è¨­å®šã§ã™ã€‚

(3)ã®CopyPluginã®ç®‡æ‰€ã§ã¯canvaskit.wasmã‚’ãƒ“ãƒ«ãƒ‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚³ãƒ”ãƒ¼ã—ã¦ã„ã¾ã™ã€‚Webpackã®ãã®ã¾ã¾ã®è¨­å®šã ã¨node_modulesé…ä¸‹ã®wasmãƒ•ã‚¡ã‚¤ãƒ«ãŒå…¬é–‹ã•ã‚Œãªã„ãŸã‚ã‚³ãƒ”ãƒ¼ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä»Šå›ã‚³ãƒ”ãƒ¼å…ˆã‚’`static/chunks/pages/posts`ã«ã—ã¦ã„ã‚‹ã®ã§ã™ãŒã€ Next.jsã§ãã®ã¾ã¾ãƒˆãƒƒãƒ—ã«ã‚³ãƒ”ãƒ¼ã—ãŸå ´åˆã€canvaskit.wasmã‚’å–å¾—ã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆå…ˆã®ãƒ‘ã‚¹ãŒ`/pages/posts/canvaskit.wasm` ã®ã‚ˆã†ã«è©²å½“ãƒšãƒ¼ã‚¸ã®ãƒ•ã‚©ãƒ«ãƒ€ã®ä¸‹ã«ãªã£ã¦ã—ã¾ã†ãŸã‚ã€é…ä¸‹ã«ç›´æ¥ã‚³ãƒ”ãƒ¼ã—ã¦ã„ã¾ã™ã€‚(ãƒˆãƒƒãƒ—ã«ç½®ã„ã¦ã†ã¾ãå–å¾—å…ˆã®ãƒ‘ã‚¹ã‚’å¤‰ãˆã‚‰ã‚Œã‚Œã°ã‚ˆã„ã®ã§ã™ãŒã€æ–¹æ³•ãŒã‚ã‹ã‚‰ãªã‹ã£ãŸãŸã‚ä»Šå›ã¯ã“ã®å½¢ã«ã—ã¾ã—ãŸ)

(4)ã®`config.externals`ã®è¨­å®šã¯reanimatedã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãªã„å ´åˆã«å¿…è¦ã§ã™ã€‚

ã¾ãŸã€`node_modules/@shopify/react-native-skia`ã‚’transpileã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€next-transpile-modulesã‚’ä½¿ã„ã¾ã™ã€‚transpileã—ãªã„ã¨JSXã®è¨˜è¿°ã§syntaxã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã™ã€‚

```js
const withTM = require("next-transpile-modules")([
  "@shopify/react-native-skia",
])

withTM(configs)
```

webpackã®è¨­å®šã§è¿·ã£ãŸå ´åˆã¯ã€[react-native-skiaã®exampleã®è¨­å®š](https://github.com/Shopify/react-native-skia/blob/main/example/webpack.config.js)ç­‰ã‚’å‚è€ƒã«ã™ã‚‹ã¨ã‚ˆã„ã¨æ€ã„ã¾ã™ã€‚ã¾ãŸã€ã“ã®ãƒ–ãƒ­ã‚°ã®next.config.jsã¯[ã“ã¡ã‚‰](https://github.com/gaishimo/omoidasu-tech-blog/blob/main/next.config.js)ã§ç¢ºèªå¯èƒ½ã§ã™ã€‚


å®Ÿéš›ã«Reactã§Skiaã®Componentã‚’æç”»ã™ã‚‹ã«ã¯`<WithSkiaWeb />`ã§`getComponent`propã‚’æŒ‡å®šã—è©²å½“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’dynamic importã§èª­ã¿è¾¼ã¿ã¾ã™ã€‚ã“ã†ã™ã‚‹ã“ã¨ã§å…¨ä½“ãŒå¾…ã¡çŠ¶æ…‹ã«ãªã‚‹ã“ã¨ãªãã€Skiaã®ãƒ­ãƒ¼ãƒ‰ãŒçµ‚ã‚ã£ãŸå¾Œã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’èª­ã¿è¾¼ã‚“ã§æç”»ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```jsx
<WithSkiaWeb
  getComponent={() => import("./MySkiaComponent")}
  fallback={<Text>Loading Skia...</Text>} />
```

å…¨ä½“ã‚’é…å»¶ã•ã›ã¦ã‚‚ã‚ˆã„å ´åˆã¯`LoadSkiaWeb()`ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚è©³ã—ãã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚[Web Support | React Native Skia](https://shopify.github.io/react-native-skia/docs/getting-started/web#loading-skia)


## å®Ÿéš›ã«react-native-skiaã§æç”»ã—ã¦ã¿ã‚‹

ã•ã£ããSkiaã§æç”»ã‚’è©¦ã—ã¦ã¿ã¾ã™ã€‚æ˜Ÿã‚’`<Path />`ã§æã„ã¦ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¦ã¿ã¾ã—ãŸã€‚é•·æŠ¼ã—ã™ã‚‹ã¨ã¼ã‹ã—åŠ¹æœãŒå…¥ã‚‹ã‚ˆã†ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚


<View style={{ marginTop: 16 }}>
  <WithSkiaWeb
    getComponent={() =>
      import("../../components/pages/2022-08-07-rn-skia-in-blog/SkiaStar")
    }
    fallback={<ActivityIndicator color="gray" size="small" />}
  />
</View>


```jsx
  const onTouch = useTouchHandler({
    onStart: () => {
      runTiming(value, 10, {
        duration: 600,
      })
    },
    onEnd: () => {
      runTiming(value, 0, {
        duration: 1000,
      })
    },
  })
  return (
    <Canvas onTouch={onTouch}>
      <Group>
        <Path
          strokeCap={"round"}
          strokeWidth={10}
          style="fill"
          path="M 128 0 L 168 80 L 256 93 L 192 155 L 207 244 L 128 202 L 49 244 L 64 155 L 0 93 L 88 80 L 128 0 Z"
        >
          <Blur blur={value} />
          <LinearGradient
            start={vec(0, 0)}
            end={vec(280, 280)}
            colors={["#30cfd0", "#330867"]}
          />
        </Path>
      </Group>
    </Canvas>
  )
```

ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ã¼ã‹ã—åŠ¹æœãŒç°¡å˜ã«è¡Œãˆã‚‹ã®ãŒé©šãã§ã™ã€‚

ã¤ã„ã§ã«ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚‚ä½œã£ã¦ã¿ã¾ã—ãŸã€‚

<View style={{ marginBottom: 16 }}>
  <WithSkiaWeb
    getComponent={() =>
      import("../../components/pages/2022-08-07-rn-skia-in-blog/LinearGradientButton")
    }
    fallback={<ActivityIndicator color="gray" size="small" />}
  />
</View>


```jsx
<TouchableOpacity>
  <View
    style={{
      alignItems: "center",
      justifyContent: "center",
      width: 256,
      height: 48,
    }}
  >
    <Canvas
      style={[StyleSheet.absoluteFill, { width: "100%", height: "100%" }]}
    >
      <RoundedRect x={0} y={0} width={256} height={48} r={8}>
        <LinearGradient
          start={vec(0, 10)}
          end={vec(256, 38)}
          colors={["#10408E", "#11A4FF"]}
        />
      </RoundedRect>
    </Canvas>
    <View
      style={[
        StyleSheet.absoluteFill,
        {
          width: "100%",
          height: "100%",
          alignItems: "center",
          justifyContent: "center",
        },
      ]}
    >
      <Text
        style={{
          color: "white",
          fontWeight: "500",
          fontSize: 16,
          letterSpacing: 2,
        }}
      >
        Title
      </Text>
    </View>
  </View>
</TouchableOpacity>
```

## æ‰€æ„Ÿ


ä»Šã¾ã§React Nativeã§ç‰¹å®šã®è¡¨ç¾ã®UIã‚’å®Ÿè£…ã—ã‚ˆã†ã¨ã—ãŸå ´åˆã€åŠ´åŠ›ã‚’è¦ã™ã‚‹ã“ã¨ãŒå¤šã€…ã‚ã‚Šã¾ã—ãŸã€‚ä¾‹ãˆã°ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®æç”»ã‚’ã—ãŸã„å ´åˆ[react-native-linear-gradient](https://github.com/react-native-linear-gradient/react-native-linear-gradient)ç­‰ã€iOS/Androidãƒã‚¤ãƒ†ã‚£ãƒ–ã®æ©Ÿèƒ½ã‚’ãƒ–ãƒªãƒƒã‚¸ã—ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ä½¿ã†å¿…è¦ãŒã‚ã‚Šã€ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³1ã¤ä½œã‚‹ã®ã«ä¸€è‹¦åŠ´ã§ã—ãŸã€‚

react-native-skiaãŒæä¾›ã•ã‚ŒãŸã“ã¨ã«ã‚ˆã‚ŠUIè¡¨ç¾ã«é–¢ã™ã‚‹ã“ã‚Œã‚‰ã®ãƒãƒƒã‚¯ãŒå¤§å¹…ã«è§£æ¶ˆã•ã‚Œãã†ã§ã™ã€‚ä»Šå¾Œã¯React Nativeã®UIã®ä½œã‚Šæ–¹ã‚‚å¤‰ã‚ã£ã¦ãã‚‹ã®ã§ã¯ãªã„ã‹ã¨æ€ã„ã¾ã™ã€‚è¡¨ç¾ã‚„åŠ¹æœã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç­‰ãŒã‚ˆã‚Šå……å®Ÿã—ãŸã‚¢ãƒ—ãƒªç­‰ãŒä½œã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã¯ã¨ã¦ã‚‚ã‚ã‚ŠãŒãŸã„ã§ã™ã€‚

ã¾ãŸã€Reactã§å®£è¨€çš„UIã‚’ä½¿ã£ã¦æç”»ã‚’è¡Œãˆã‚‹ã¨ã„ã†ç‚¹ã‚‚å¤§å¤‰é­…åŠ›çš„ãªç‚¹ã ã¨æ€ã„ã¾ã™ã€‚
