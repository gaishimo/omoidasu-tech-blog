import { parse, parseISO } from "date-fns"
import { PostLayout } from "../../components/PostLayout"
import { ImageWrapper } from "../../components/atoms/ImageWrapper"
export const meta = {
  title: "Expoã®Managed Workflowã§ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’å®Ÿè£…ã™ã‚‹",
  tagNames: ["expo", "react-native", "eas"],
  color1: "rgb(67,49,230)",
  color2: "rgb(200,50,50)",
  createdAt: parse(
    "2021-09-01 10:35:00 +09:00",
    "yyyy-MM-dd HH:mm:ss XXX",
    new Date(),
  ),
  author: "@gaishimo",
  description:
    "Expoã®EAS Buildã§ã€Managed Workflowãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’å®Ÿè£…ã™ã‚‹æ‰‹é †ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚",
  imagePath: "/posts/2021-08-28-eas-iap/expo-iap-image.png",
  lastUpdatedAt: parse(
    "2022-01-21 17:00:00 +09:00",
    "yyyy-MM-dd HH:mm:ss XXX",
    new Date(),
  ),
}

export const headlines = [
   { title: "æ¦‚è¦", children: [{ title: "å‰æ" }] },
   { title: "ä»¥å‰ã®Classic Buildã§ã¯Ejectã™ã‚‹å¿…è¦ãŒã‚ã£ãŸ" },
   { title: "EAS Buildã§ã‚¢ãƒ—ãƒªå†…èª²é‡‘ãŒå¯èƒ½ã«" },
   { title: "expo-in-app-purchasesã®è¿½åŠ " },
   { title: "AppStoreãƒ»Google Playã®è¨­å®š" },
   {
     title: "Development Clientã®å°å…¥",
     children: [
       { title: "expo-dev-clientã®è¿½åŠ " },
       { title: "EASã®è¨­å®š" },
       { title: "Adhocã®è¨­å®š" },
       { title: "EAS Buildã®å®Ÿè¡Œ" },
       { title: "DevClientã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«" },
       { title: "DevClientã®èµ·å‹•" },
     ]
   },
   { title: "ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã®å®Ÿè£…" },
   { title: "Androidã§ã®å‹•ä½œç¢ºèª" },
   {
     title: "ã‚¢ãƒ—ãƒªå†…èª²é‡‘å®Ÿè£…ã§ã®ãã®ä»–æ³¨æ„ç‚¹",
     children: [
       { title: "iOSã®å¾©å…ƒå‡¦ç†" },
       { title: "iOSã§è³¼å…¥ãŒä¸­æ–­ã•ã‚ŒãŸå ´åˆã®å‡¦ç†" },
       { title: "Androidã§ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰è³¼å…¥ã®æ‰¿èªãŒå¿…è¦ãªå ´åˆ" },
       { title: "ãƒ¬ã‚·ãƒ¼ãƒˆã€è³¼å…¥ãƒˆãƒ¼ã‚¯ãƒ³ã®æ¤œè¨¼" },
     ]
   },
   { title: "OTA Updateã‚’è¡Œã†å ´åˆã®æ³¨æ„" },
   { title: "çµ‚ã‚ã‚Šã«" },
]

export default props => (
  <PostLayout headlines={headlines} meta={meta}>
    {props.children}
  </PostLayout>
)

## æ¦‚è¦

Expo(React Native)ã®Managed Workflowã§ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’å®Ÿè£…ã™ã‚‹æ‰‹é †ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯[expo-in-app-purchases](https://docs.expo.dev/versions/latest/sdk/in-app-purchases/)ã‚’ä½¿ã„ã¾ã™ã€‚

### å‰æ

- Expo SDK: 42
- expo-in-app-purchase: 10.2.0
- èª²é‡‘ã‚¢ã‚¤ãƒ†ãƒ : éæ¶ˆè€—å‹(ä¸€åº¦é™ã‚Šè³¼å…¥ã™ã‚‹ã‚‚ã®)

*ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦ã¯ä»Šå›ã¯è¨˜è¼‰ã—ã¦ã„ã¾ã›ã‚“ãŒã€Expoã§ã®ãƒ“ãƒ«ãƒ‰ã€ç’°å¢ƒæ§‹ç¯‰ã®æµã‚Œã¯åŒã˜ãªãŸã‚ã€ãã®éƒ¨åˆ†ã¯å‚è€ƒã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚


## ä»¥å‰ã®Classic Buildã§ã¯Ejectã™ã‚‹å¿…è¦ãŒã‚ã£ãŸ

å¾“æ¥ã€Expoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’å®Ÿè£…ã™ã‚‹ã«ã¯Ejectã‚’è¡Œã„Bare Workflowã«å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚ã“ã‚Œã¯Expoã®æ—§å½¢å¼ã®ãƒ“ãƒ«ãƒ‰(Classic Build)ã®ä»•çµ„ã¿ã«ã‚ˆã‚‹åˆ¶ç´„ã§ã™ã€‚

Classicãƒ“ãƒ«ãƒ‰ã¯ã‚ã‚‰ã‹ã˜ã‚ä½¿ã‚ã‚Œãã†ãªNativeãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã²ã¨ã¾ã¨ã¾ã‚Šã¨ã—ã¦ç”¨æ„ã—ã¦ãŠã(Shell App)ã€ãã‚Œã‚’å…ƒã«ã‚¢ãƒ—ãƒªãƒã‚¤ãƒŠãƒªã‚’ä½œæˆã™ã‚‹ã¨ã„ã†ä»•çµ„ã¿ã«ãªã£ã¦ã„ã¾ã™ã€‚
[Expo managed workflow in 2021. Part 1: The preset Expo runtime | by Brent Vatne | Exposition](https://blog.expo.dev/expo-managed-workflow-in-2021-5b887bbf7dbb)


ãã®ã²ã¨ã¾ã¨ã¾ã‚Šã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä¸­ã«ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã®æ©Ÿèƒ½ã¯å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãã“ã«ç‹¬è‡ªã«ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã›ã‚“ã€‚ã¾ãŸã€ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’å‹•ä½œã•ã›ã‚‹ã«ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã«ä¸€ã¤ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªã‚¢ãƒ—ãƒªã‚’æŒã¤å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€é–‹ç™ºç”¨ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¢ãƒ—ãƒª(Expo Go)ãŒä¸€ã¤ã—ã‹åˆ©ç”¨ã§ããªã„ãŸã‚ã€é–‹ç™ºæ™‚ã«ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒä»•çµ„ã¿ä¸Šãã‚‚ãã‚‚ã§ããªã„çŠ¶æ…‹ã§ã—ãŸã€‚

Managed WorkflowãŒä½¿ãˆãªã„ã¨ãªã‚‹ã¨ã€Expoã‚’ä½¿ã†åˆ©ç‚¹ãŒã‹ãªã‚Šæãªã‚ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚ã“ã®ç‚¹ãŒExpoã‚’é¸æŠã™ã‚‹ä¸Šã§ã®ä¸€ã¤ã®ãƒãƒƒã‚¯ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚


## EAS Buildã§ã‚¢ãƒ—ãƒªå†…èª²é‡‘ãŒå¯èƒ½ã«

ã—ã‹ã—ã€2021å¹´ã«ExpoãŒæä¾›ã‚’é–‹å§‹ã—ãŸ[EAS Build](https://docs.expo.dev/build/introduction/)ã¨ã„ã†ãƒ“ãƒ«ãƒ‰æ–¹å¼ã«ã‚ˆã‚Šã€Managed Workflowã§ã‚ã£ã¦ã‚‚ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’çµ„ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

EAS Buildã¯Classic Buildã¨ç•°ãªã‚Šç‹¬è‡ªã®Nativeãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚EAS Buildã®ä»•çµ„ã¿ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®å…¬å¼ãƒ–ãƒ­ã‚°ã®è¨˜äº‹ãŒå‚è€ƒã«ãªã‚Šã¾ã™ã€‚
[Expo managed workflow in 2021. Part 2: Customizing the runtime | by Brent Vatne | Exposition](https://blog.expo.dev/expo-managed-workflow-in-2021-d1c9b68aa10)

æ›´ã«ã€[Custom Development Clients](https://docs.expo.dev/clients/introduction/)ã¨ã„ã†ã‚‚ã®ã‚’ãƒ“ãƒ«ãƒ‰ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã“ã‚Œã¯ç‹¬è‡ªã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¢ãƒ—ãƒª(Expo Goã‚¢ãƒ—ãƒªã«ä»£ã‚ã‚‹ã‚‚ã®)ã‚’ãƒ“ãƒ«ãƒ‰ãƒ»å†…éƒ¨é…å¸ƒã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šé–‹ç™ºæ™‚ã«ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã®æ©Ÿèƒ½ã‚’åˆ©ç”¨ãƒ»æ¤œè¨¼ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚
[Introducing: Custom Development Clients | by TC Davis | Jul, 2021 | Exposition](https://blog.expo.dev/introducing-custom-development-clients-5a2c79a9ddf8)


ã“ã‚Œã‚‰ã®æ©Ÿèƒ½ã¯2021å††8æœˆæ™‚ç‚¹ã§ã¯ã¾ã Previewã®ãŸã‚ã€åˆ©ç”¨ã™ã‚‹ã«ã¯[Priorityãƒ—ãƒ©ãƒ³(æœˆ29ãƒ‰ãƒ«)](https://expo.dev/pricing)ã«åŠ å…¥ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚([Previewã¯ãƒ™ãƒ¼ã‚¿ç‰ˆã®ã‚ˆã†ãªä½ç½®ã¥ã‘ã¨ã¯ç•°ãªã‚Šã€ãƒ¦ãƒ¼ã‚¶ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å—ã‘ã‚‹ãŸã‚ã®æœŸé–“ã¨ã®ã“ã¨ã§ã™](https://docs.expo.dev/feature-preview/#what-does-feature-preview-mean))

æ—§æ–¹å¼ã®ãƒ“ãƒ«ãƒ‰(Classicãƒ“ãƒ«ãƒ‰)ã¯ä»Šå¾Œã‚‚ã‚µãƒãƒ¼ãƒˆã¯ç¶šãã¾ã™ãŒã€EAS BuildãŒä¸»åŠ›ã«ãªã£ã¦ã„ãã‚‚ã®ã¨æ€ã‚ã‚Œã¾ã™ã€‚

å¼Šç¤¾ã®Simplunaã¨ã„ã†ã‚¢ãƒ—ãƒª([iOS](https://apps.apple.com/jp/app/id1528652349?ign-itsct=apps_box&ign-itscg=30200) & [Android](https://play.google.com/store/apps/details?id=app.simpluna))ã§ã¯ã€2021å¹´7æœˆã‹ã‚‰EAS Buildã‚’åˆ©ç”¨ã—ã¦ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’æä¾›ã—ã¦ã„ã¾ã™ãŒã€ç‰¹ã«å•é¡Œãªãå‹•ä½œãƒ»é‹ç”¨ã§ãã¦ã„ã¾ã™ã€‚ã‚¢ãƒ—ãƒªã‚’åˆå›ãƒªãƒªãƒ¼ã‚¹ã—ãŸ2020å¹´8æœˆæ™‚ç‚¹ã§ã¯ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’å°å…¥ã™ã‚‹ã«ã¯Ejectã™ã‚‹ã—ã‹ãªã„çŠ¶æ…‹ã§ã—ãŸãŒã€[ã„ãšã‚ŒManaged Workflowã§ã‚‚ã‚µãƒãƒ¼ãƒˆã•ã‚Œãã†ã ã£ãŸã®ã§](https://expo.canny.io/feature-requests/p/in-app-purchases)ã€æœ€åˆã¯ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’å«ã‚ãšã«ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚Managed Workflowã®ã¾ã¾ç„¡æ–™ã®ã¿ã§ãƒ¦ãƒ¼ã‚¶ã‚’å¢—ã‚„ã—æ”¹å–„ã—ã¦ã„ããªãŒã‚‰ã€ã‚¢ãƒ—ãƒªå†…èª²é‡‘ãŒã‚µãƒãƒ¼ãƒˆã•ã‚ŒãŸæ™‚ç‚¹ã§å°å…¥ã™ã‚‹ã¨ã„ã†è¨ˆç”»ã§ã—ãŸã€‚1å¹´ã»ã©çµŒã£ã¦ã¤ã„ã«EAS BuildãŒPreviewã§æä¾›ã•ã‚ŒãŸãŸã‚ã€2021å¹´7æœˆã«å°å…¥ã—ãŸã¨ã„ã†æµã‚Œã«ãªã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã§ã¯ã€å®Ÿéš›ã«ã©ã®ã‚ˆã†ã«å°å…¥ã—ã¦ã„ãã‹ã‚’èª¬æ˜ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚


## expo-in-app-purchasesã®è¿½åŠ 

å®Ÿè£…ã¯[expo-in-app-purchases](https://www.npmjs.com/package/expo-in-app-purchases)ã‚’ä½¿ã£ã¦è¡Œã„ã¾ã™ã€‚ã¾ãšé€šå¸¸é€šã‚Šãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’package.jsonã«è¿½åŠ ã—ã¾ã™ã€‚

```bash
yarn add expo-in-app-purchases
```

â€»npmã®å ´åˆã¯éšæ™‚å¤‰æ›´ã—ã¦ãã ã•ã„

React Nativeã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ˆã£ã¦ã¯ã€è¨­å®šã§Nativeéƒ¨åˆ†ã«é–¢é€£ã™ã‚‹ä¿®æ­£(iosãƒ•ã‚©ãƒ«ãƒ€ãƒ»androidãƒ•ã‚©ãƒ«ãƒ€å†…ã§ç™ºç”Ÿã™ã‚‹ä¿®æ­£)ãŒå¿…è¦ãªå ´åˆãŒã‚ã‚Šã¾ã™ã€‚ãã®å ´åˆã¯[Config Plugin](https://docs.expo.dev/guides/config-plugins/)ã‚’åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã™ãŒã€expo-in-app-purchasesã«é–¢ã—ã¦ã¯ãƒã‚¤ãƒ†ã‚£ãƒ–å›ºæœ‰ã®è¨­å®šã¯å¿…è¦ãªã„ãŸã‚ä¸è¦ã§ã™ã€‚



## AppStoreãƒ»Google Playã®è¨­å®š

ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯äº‹å‰ã«AppStoreã¨Google Playã®è¨­å®šã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

æ‰‹é †ã¯[InAppPurchasesã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.expo.dev/versions/latest/sdk/in-app-purchases/#setup) ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹é€šã‚Šãªã®ã§ã™ãŒã€iOSã®In-App Purchaseã®Capabilityã®è¨­å®šã¯è‡ªå‹•ã§è¡Œã‚ã‚Œã‚‹ãŸã‚ç‰¹ã«è¨­å®šã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

Google Playã«ã¤ã„ã¦ã¯ã€ä¸€åº¦ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å«ã‚€çŠ¶æ…‹ã§ã‚¢ãƒ—ãƒªã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‚’ä½œæˆã—ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã†ã—ãªã„ã¨èª²é‡‘ã‚¢ã‚¤ãƒ†ãƒ ã®è¨­å®šç”»é¢ã«é€²ã‚ã¾ã›ã‚“ã€‚ä»Šå›ã®æ‰‹é †ã§ã¯å¾Œã§ãƒ“ãƒ«ãƒ‰ã‚’ä½œæˆã™ã‚‹ãŸã‚ã€ä¸€æ—¦å¾Œå›ã—ã«ã—ã¾ã™ã€‚


## Development Clientã®å°å…¥

ã“ã®çŠ¶æ…‹ã§expo-in-app-purchasesã‚’ç”¨ã„ã¦ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã—ã¦ã‚‚ã€Expo Goã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ãŸã¨ãã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã—ã¾ã„ã¾ã™ã€‚ã“ã‚Œã¯å‰è¿°ã—ãŸã¨ãŠã‚Šã€Expo Goã‚¢ãƒ—ãƒªã§ã¯expo-in-app-purchasesã®Native ModuleãŒæä¾›ã•ã‚Œã¦ã„ãªã„ãŸã‚ã§ã™ã€‚

ã“ã®ã¾ã¾ã§ã¯Expo Goã§ã¯é–‹ç™ºãŒã§ããªã„ãŸã‚ã€expo-in-app-purchasesã‚’å«ã‚“ã ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¢ãƒ—ãƒª(Custom Development Clients)ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚

DevClientã¯ä½œæˆã›ãšã«é€šå¸¸ã®ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ãƒ“ãƒ«ãƒ‰(aab, ipa)ã‚’ç”Ÿæˆã—ã€ç«¯æœ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’æ¤œè¨¼ã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚‹ã¨æ€ã„ã¾ã™ãŒã€ãã®å ´åˆé–‹ç™ºã—ãªãŒã‚‰èª²é‡‘ã‚’æ¤œè¨¼ã™ã‚‹ã“ã¨ãŒã§ããšåŠ¹ç‡ãŒæ‚ªããªã‚Šã¾ã™ã€‚ã¾ãŸExpo Goã®å ´åˆã¯expo-in-app-purchasesã‚’importã—ãªã„ã‚ˆã†ã«ã™ã‚‹ç­‰ã®å¯¾å¿œãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚è«¸ã€…æ‰‹é–“ãŒã‹ã‹ã‚‹ãŸã‚ã€DevClientã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚


### expo-dev-clientã®è¿½åŠ 

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«expo-dev-clientãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```bash
yarn add expo-dev-client
```

ã‚¢ãƒ—ãƒªã®ã‚³ãƒ¼ãƒ‰ãƒˆãƒƒãƒ—(App.tsx) ã«expo-dev-clientã®importã‚’è¿½åŠ ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€DevClientä¸Šã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚ã‹ã‚Šã‚„ã™ãè¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã™ã‚‹ãŸã‚ã§ã™ã€‚

```javascript
import "expo-dev-client"
```


[Getting Started - Expo Documentation](https://docs.expo.dev/clients/getting-started/)



### EASã®è¨­å®š

EASãƒ“ãƒ«ãƒ‰ã®è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚`eas build::configure`ã§EASã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚ã‚‹`eas.json`ã‚’ç”Ÿæˆã—ã¾ã™ã€‚äº‹å‰ã«eas-cliã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦ã§ã™(`npm install -g eas-cli`)ã€‚

```bash
$ eas build:configure
ğŸ’¡ The following process will configure your iOS and/or Android project to be compatible with EAS Build. These changes only apply to your local project files and you can safely revert them at any time.

âœ” Which platforms would you like to configure for EAS Build? â€º All

âœ” Generated eas.json

ğŸ“  Android application id Learn more: https://expo.fyi/android-package
âœ” What would you like your Android application id to be? â€¦ <çœç•¥>

ğŸ“  iOS Bundle Identifier Learn more: https://expo.fyi/bundle-identifier
âœ” What would you like your iOS bundle identifier to be? â€¦ <çœç•¥>

âœ” Can we commit these changes to git for you? â€º Yes
âœ” Commit message: â€¦ Configure EAS Build
âœ” Committed changes

ğŸ‰ Your iOS and Android projects are ready to build.

- Run eas build when you are ready to create your first build.
- Once the build is completed, run eas submit to upload the app to the Apple App Store or Google Play Store
- Learn more about other capabilities of EAS Build: https://docs.expo.dev/build/introduction
```

ä»¥ä¸‹ã®å†…å®¹ã§eas.jsonãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚
```json
{
  "build": {
    "release": {},
    "development": {
      "developmentClient": true,
      "distribution": "internal"
    }
  }
}
```

`release`ã¨å…±ã« `development` ã¨ã„ã†profileåã®è¨­å®šãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚`"developmentClient": true`ã¯é–‹ç™ºã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”¨ã®ãƒ“ãƒ«ãƒ‰ã§ã‚ã‚Šã€`"distribution": "internal"`ã¯å†…éƒ¨é…å¸ƒã§ã‚ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚

åŒæ™‚ã«app.jsonã«Bundle ID(ios)ã€packageå(android)ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚

### Adhocã®è¨­å®š

iOSã§Development Clientã‚’å†…éƒ¨é…å¸ƒã™ã‚‹ã«ã¯ã€ad hoc provisioning profileã«å¯¾ã—ã¦ç«¯æœ«ã®UDIDã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚


`eas device:create` ã‚’å®Ÿè¡Œã—ã€

```bash
$ eas device:create
This command lets you register your Apple devices (iPhones and iPads) for internal distribution of your app.
Internal distribution means that you won't need upload your app archive to App Store / Testflight.
Your app archive (.ipa) will be installable on your equipment as long as you sign your application with an adhoc provisiong profile.
The provisioning profile needs to contain the UDIDs (unique identifiers) of your iPhones and iPads.

First of all, please choose the Expo account under which you want to register your devices.
Later, authenticate with Apple and choose your desired Apple Team (if your Apple ID has access to multiple teams).

âœ” You're inside the project directory. Would you like to use <çœç•¥> account? â€¦ yes
â€º Log in to your Apple Developer account to continue
âœ” Apple ID: â€¦ <çœç•¥>
â€º Restoring session /home/gaishimo/.app-store/auth/<çœç•¥>/cookie
â€º Session expired Local session
â€º The password is only used to authenticate with Apple and never stored on EAS servers
  Learn more: https://bit.ly/2VtGWhU
âœ” Password (for <çœç•¥>): â€¦ ********************
â€º Saving Apple ID password to the local Keychain
  Learn more: https://docs.expo.io/distribution/security#keychain
âœ” Logged in New session
â€º Team <çœç•¥> (<çœç•¥> )
â€º Provider <çœç•¥>  (<çœç•¥> )
âœ” How would you like to register your devices? â€º Website - generates a registration URL to be opened on your devices

[QR Code]

Open the following link on your iOS devices (or scan the QR code) and follow the instructions to install the development profile:

https://expo.io/register-device/<çœç•¥>
```

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ä¸Šã«QRã‚³ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãŸã‚ã€iOSãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰ã‚«ãƒ¡ãƒ©ã§QRã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã€Provisioning Profileã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ»ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚



### EAS Buildã®å®Ÿè¡Œ

è¨­å®šãŒå®Œäº†ã—ãŸã‚‰ã€Development Clientã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦ã¿ã¾ã™ã€‚`eas build`ã‚³ãƒãƒ³ãƒ‰ã§ã€`--profile`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«`development`ã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã—ã¾ã™ã€‚
```bash
$ eas build --platform all --profile development
âœ” Created <çœç•¥>/expo-iap-example (https://expo.dev/accounts/<çœç•¥>/projects/expo-iap-example) on Expo
âœ” Using remote Android credentials (Expo server)
âœ” Generate a new Android Keystore? â€¦ yes
âœ” Created keystore
âœ” Compressed project files 17s (206 MB)
âœ” Uploaded to EAS 11s Learn more: https://expo.fyi/eas-build-archive
âœ” Linked to project <çœç•¥> (https://expo.dev/accounts/<çœç•¥>/projects/expo-iap-example)
âœ” Using remote iOS credentials (Expo server)

If you provide your Apple account credentials we will be able to generate all necessary build credentials and fully validate them.
This is optional, but without Apple account access you will need to provide all the values manually and we can only run minimal validation on them.
âœ” Do you want to log in to your Apple account? â€¦ yes

â€º Log in to your Apple Developer account to continue
âœ” Apple ID: â€¦ <çœç•¥>
â€º Restoring session /home/gaishimo/.app-store/auth/<çœç•¥>/cookie
â€º Session expired Local session
â€º The password is only used to authenticate with Apple and never stored on EAS servers
  Learn more: https://bit.ly/2VtGWhU
âœ” Password (for <çœç•¥>): â€¦ **********
â€º Saving Apple ID password to the local Keychain
  Learn more: https://docs.expo.dev/distribution/security#keychain
âœ” Logged in New session
â€º Team <çœç•¥> (<çœç•¥>)
â€º Provider <çœç•¥> (<çœç•¥>)
âœ” Bundle identifier registered <çœç•¥>
âœ” Synced capabilities: No updates
âœ” Synced capability identifiers: No updates
âœ” Fetched Apple distribution certificates
âœ” Reuse this distribution certificate?
Cert ID: <çœç•¥>, Serial number: <çœç•¥>, Team ID: <çœç•¥>, Team name: <çœç•¥> (Company/Organization)
    Created: 5 days ago, Updated: 5 days ago,
    Expires: Tue, 23 Aug 2022 00:17:32 GMT+0000
    ğŸ“² Used by: <çœç•¥> â€¦ yes
Using distribution certificate with serial number <çœç•¥>
âœ” Select devices for the adhoc build: â€º <çœç•¥>
âœ” Created new profile: *[expo] <çœç•¥>

Project Credentials Configuration:
  Project: <çœç•¥>
  Bundle Identifier: <çœç•¥>
  Configuration: Ad Hoc

  Distribution Certificate:
    Serial Number: <çœç•¥>
    Expiration Date: Tue, 23 Aug 2022 00:17:32 GMT+0000
    Apple Team: <çœç•¥>x
    Updated 5 days ago

  Provisioning Profile:
    Developer Portal ID: <çœç•¥>
    Status: active
    Expiration Date: Tue, 23 Aug 2022 00:17:32 GMT+0000
    Apple Team: <çœç•¥>
    Provisioned devices:
    - iPhone 11 Pro (UDID: <çœç•¥>)
    Updated 2 seconds ago

All credentials are ready to build <çœç•¥>

âœ” Would you like to setup Push Notifications for your project? â€¦ no
âœ” Compressed project files 16s (206 MB)
âœ” Uploaded to EAS 12s Learn more: https://expo.fyi/eas-build-archive

Android build details: https://expo.dev/accounts/<çœç•¥>/builds/<çœç•¥>
iOS build details: https://expo.dev/accounts/<çœç•¥>/builds/<çœç•¥>

Waiting for builds to complete. You can press Ctrl+C to exit.
```

### DevClientã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ãƒ“ãƒ«ãƒ‰ãŒæˆåŠŸã—ãŸã‚‰ã€ãƒ“ãƒ«ãƒ‰çµæœãƒšãƒ¼ã‚¸ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚QRã‚³ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€iPhoneç«¯æœ«ã§èª­ã¿å–ã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

<ImageWrapper width="80%" maxWidth={240} alt="DevClientã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«" sourceUri="/posts/2021-08-28-eas-iap/install-dev-client-ios.png"  />

### DevClientã®èµ·å‹•

DevClientã‚’ç«¯æœ«ä¸Šã§èµ·å‹•ã—ã¦ã¿ã¾ã™ã€‚

ã¾ãšã‚µãƒ¼ãƒã‚’èµ·å‹•ã—ã¾ã™ã€‚expo startã®éš›ã«`--dev-client`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¦èµ·å‹•ã—ã¾ã™ã€‚
```bash
expo start --dev-client
```

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ä¸Šã«è¡¨ç¤ºã•ã‚Œã‚‹QRã‚³ãƒ¼ãƒ‰ã‚’ç«¯æœ«ã®ã‚«ãƒ¡ãƒ©ã§èª­ã¿å–ã‚‹ã¨ã€ç„¡äº‹Dev ClientãŒèµ·å‹•ã—ã¾ã—ãŸ! ã“ã‚Œã§ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’é–‹ç™ºã™ã‚‹ç’°å¢ƒãŒæ•´ã„ã¾ã—ãŸã€‚


<ImageWrapper width="80%" maxWidth={200} alt="DevClientã‚’èµ·å‹•" sourceUri="/posts/2021-08-28-eas-iap/dev-client-run-ios.jpeg"  />


## ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã®å®Ÿè£…

é–‹ç™ºç”¨ã®ç’°å¢ƒãŒæ•´ã£ãŸã®ã§ã€expo-in-app-purhchasesã‚’ç”¨ã„ã¦ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã®å®Ÿè£…ã‚’ã—ã¾ã™ã€‚

ä»¥ä¸‹ãŒã‚³ãƒ¼ãƒ‰ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚æœ€ä½é™ã€ã‚¢ã‚¤ãƒ†ãƒ è³¼å…¥ãŒã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã®ã‚³ãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™ã€‚

```javascript
import "expo-dev-client"
import {
  connectAsync,
  finishTransactionAsync,
  getProductsAsync,
  IAPItemDetails,
  IAPQueryResponse,
  IAPResponseCode,
  InAppPurchase,
  purchaseItemAsync,
  setPurchaseListener,
} from "expo-in-app-purchases"
import { StatusBar } from "expo-status-bar"
import React, { useCallback, useEffect, useState } from "react"
import { ActivityIndicator, Button, StyleSheet, Text, View } from "react-native"

const PRODUCT_ID = "<çœç•¥>"

export default function App() {
  const [purchasing, setPurchasing] = useState<boolean>(false)
  const [productItem, setProductItem] = useState<IAPItemDetails | null>(null)

  const prepare = useCallback(async () => {
    try {
      await connectAsync()

      setPurchaseListener(async (result: IAPQueryResponse<InAppPurchase>) => {
        const { responseCode, results, errorCode } = result
        console.log(
          `purchaseListener responseCode: ${responseCode}, errorCode: ${errorCode}`,
        )
        switch (responseCode) {
          case IAPResponseCode.OK: {
            if (results == null || results.length === 0) {
              throw new Error("no purchase results")
            }
            // androidã®å ´åˆã€unfinishãªãƒ¬ã‚³ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ãã‚‹å ´åˆãŒã‚ã‚‹ãŸã‚ã€
            // acknowledgedãŒfalseã®ã‚‚ã®ã«é™å®šã™ã‚‹
            // https://docs.expo.dev/versions/latest/sdk/in-app-purchases/#inapppurchasessetpurchaselistenercallback-result-iapqueryresponse--void
            const purchase = results.find(result => !result.acknowledged)
            if (purchase) {
              const isConsumable = false
              await finishTransactionAsync(purchase, isConsumable)
            }
            break
          }
          case IAPResponseCode.USER_CANCELED: {
            break
          }
          case IAPResponseCode.ERROR: {
            console.log("errored.", errorCode)
            break
          }
          case IAPResponseCode.DEFERRED: {
            // è¦ªã®æ‰¿èªãŒå¿…è¦ãªå ´åˆ (iOSã®å ´åˆã®ã¿)
            console.log("deferred")
            break
          }
        }
        setPurchasing(false)
      })

      const { responseCode, results } = await getProductsAsync([PRODUCT_ID])
      if (responseCode === IAPResponseCode.OK) {
        if (results == null || results.length === 0) {
          throw new Error("no results")
        }

        console.log("results:", results)
        const item = results.find(r => r.productId === PRODUCT_ID)
        if (item == null) throw new Error("item not found.")
        setProductItem(item)
      }
    } catch (err) {
      console.log(err)
    }
  }, [])

  const doPurchase = useCallback(async () => {
    try {
      setPurchasing(true)
      await purchaseItemAsync(PRODUCT_ID)
    } catch (err) {
      console.log(err)
      setPurchasing(false)
    }
  }, [])

  useEffect(() => {
    prepare()
  }, [prepare])

  return (
    <View style={styles.container}>
      <Text>Expo IAP Example!!</Text>
      <StatusBar style="auto" />
      {productItem && (
        <View style={styles.product}>
          {purchasing ? (
            <ActivityIndicator size="small" />
          ) : (
            <Button
              title={`ã‚¢ã‚¤ãƒ†ãƒ ã‚’${productItem.price}ã§è³¼å…¥`}
              onPress={doPurchase}
            />
          )}
        </View>
      )}
    </View>
  )
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: "#fff",
    alignItems: "center",
    justifyContent: "center",
  },
  product: { marginTop: 40 },
})

```

ç”»é¢ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«è³¼å…¥ãƒœã‚¿ãƒ³ã®ã¿ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
<ImageWrapper width="80%" maxWidth={240} alt="è³¼å…¥ç”¨ç”»é¢" sourceUri="/posts/2021-08-28-eas-iap/purchase-screen.jpeg"  />


ã‚³ãƒ¼ãƒ‰ã‚’ç°¡å˜ã«èª¬æ˜ã™ã‚‹ã¨ã€ç”»é¢ãƒ­ãƒ¼ãƒ‰æ™‚ã«ã¾ãšä»¥ä¸‹ã®å‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚
- `connectAsync`ã§åˆæœŸåŒ–
- `setPurchaseListener`ã§ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’è¨­å®š
- `getProductsAsync`ã§ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚’å–å¾—

ç”»é¢è¡¨ç¤ºå¾Œã€è³¼å…¥ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ãŸã‚‰`purchaseItemAsync`ã§è³¼å…¥å‡¦ç†ã‚’é–‹å§‹ã—ã€`setPurchaseListener`ã§è¨­å®šã—ãŸãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã«ãŠã„ã¦ã€è³¼å…¥ãŒæˆåŠŸã—ãŸã‚‰`finishTransactionAsync`ã‚’å‘¼ã³å‡ºã—ã¦è³¼å…¥ç¢ºå®šã¨ã„ã†æµã‚Œã«ãªã‚Šã¾ã™ã€‚


iOSã®å ´åˆã€è³¼å…¥æ™‚ã«Apple IDã§ã®ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚’æ±‚ã‚ã‚‰ã‚Œã‚‹ãŸã‚AppStore Connectã§ä½œæˆã—ãŸSandboxã®ãƒ†ã‚¹ã‚¿ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚ãƒ­ã‚°ã‚¤ãƒ³å¾ŒOSã®è³¼å…¥ç”¨ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãŸã‚ã€å†åº¦Sandboxã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

<ImageWrapper width="80%" maxWidth={240} alt="è³¼å…¥ç”¨ç”»é¢" sourceUri="/posts/2021-08-28-eas-iap/purchase-ios.png"  />


Sandboxç’°å¢ƒã®å ´åˆOSã®è³¼å…¥ç”¨ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒ2åº¦è¡¨ç¤ºã•ã‚Œã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã¯Sandboxç’°å¢ƒã®ã¿ã®ç¾è±¡ã®ãŸã‚æœ¬ç•ªç’°å¢ƒã§ã¯ç‰¹ã«å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

è³¼å…¥ãŒç„¡äº‹å®Œäº†ã™ã‚‹ã¨å®Œäº†ã®ã‚¢ãƒ©ãƒ¼ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™(iOSã®å ´åˆ)ã€‚

<ImageWrapper width="80%" maxWidth={240} alt="è³¼å…¥å®Œäº†(iOS)" sourceUri="/posts/2021-08-28-eas-iap/purchased-ios.png"  />


## Androidã§ã®å‹•ä½œç¢ºèª


Androidã®å ´åˆã€Google Play Consoleã§ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã®è¨­å®šã‚’ã™ã‚‹ã®ã«ä¸€åº¦ã‚¢ãƒ—ãƒªã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦ã‚¹ãƒˆã‚¢ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

`eas:configure`ã—ãŸéš›ã«ä½œæˆã•ã‚ŒãŸ`release`profileã§androidã®ãƒ“ãƒ«ãƒ‰ã‚’è¡Œã„ã¾ã™ã€‚

```bash
eas build --platform android --profile release
```

ãƒ“ãƒ«ãƒ‰ãŒæˆåŠŸã™ã‚‹ã¨ãƒ“ãƒ«ãƒ‰çµæœç”»é¢ã‹ã‚‰aabãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚ä¸€åº¦èª²é‡‘æ©Ÿèƒ½ãŒå«ã¾ã‚ŒãŸaabã‚’Google Play Consoleã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚Œã°ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã®ç”»é¢ã¯è¨­å®šå¯èƒ½ã«ãªã‚‹ãŸã‚ã€å†…éƒ¨ãƒ†ã‚¹ãƒˆãƒªãƒªãƒ¼ã‚¹ç­‰ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™(ãƒªãƒªãƒ¼ã‚¹è‡ªä½“ã¯å¿…ãšã—ã‚‚å…¬é–‹ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“)ã€‚ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚‰ã‚¢ãƒ—ãƒªå†…ã‚¢ã‚¤ãƒ†ãƒ ç”»é¢ã‹ã‚‰èª²é‡‘ã‚¢ã‚¤ãƒ†ãƒ ã®è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚

èª²é‡‘ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ ã—ãŸç›´å¾Œã¯ã€ã‚¢ãƒ—ãƒªã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ä¸Šã‹ã‚‰ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚’ç›´ãã«å–å¾—ã§ããªã„å ´åˆãŒã‚ã‚Šã¾ã™(productIdã‚’æŒ‡å®šã—ã¦ã€`getProductsAsync`ã—ã¦ã‚‚çµæœãŒç©ºã«ãªã‚‹)ã€‚ã—ã°ã‚‰ãå¾…ã¤ã‹ã€Androidç«¯æœ«ã®è¨­å®šã§ã‚¢ãƒ—ãƒªã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹ã¨å–å¾—ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

Androidä¸Šã§DevClientã‚’èµ·å‹•ã—è³¼å…¥ã‚’è¡Œã†ã¨è³¼å…¥ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

<ImageWrapper width="80%" maxWidth={240} alt="Androidã§ã®è³¼å…¥" sourceUri="/posts/2021-08-28-eas-iap/purchase-screen-android.png"  />

ãã®ã¾ã¾è‡ªåˆ†ã®ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã§è³¼å…¥ã™ã‚‹ã¨å®Ÿéš›ã«èª²é‡‘ã•ã‚Œã¦ã—ã¾ã†ãŸã‚ã€ã‚¢ãƒ—ãƒªãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’Gmailã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«è¨­å®šã—ã¦è³¼å…¥ã™ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’ä¿æŒã—ã¦ã„ã‚‹Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å ´åˆã€"ãƒ†ã‚¹ãƒˆã‚«ãƒ¼ãƒ‰" ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

[ã‚¢ãƒ—ãƒª ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’ä½¿ç”¨ã—ãŸã‚¢ãƒ—ãƒªå†…èª²é‡‘ã®ãƒ†ã‚¹ãƒˆ - Play Console ãƒ˜ãƒ«ãƒ—](https://support.google.com/googleplay/android-developer/answer/6062777?hl=ja)


## ã‚¢ãƒ—ãƒªå†…èª²é‡‘å®Ÿè£…ã§ã®ãã®ä»–æ³¨æ„ç‚¹

ä»Šå›ã¯æœ€ä½é™è³¼å…¥ãŒã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ãŸã‹ã£ãŸãŸã‚æœ€ä½é™ã®ã‚³ãƒ¼ãƒ‰ã—ã‹æ›¸ã„ã¦ã„ãªã„ãŸã‚ã”æ³¨æ„ãã ã•ã„ã€‚ä»¥ä¸‹ã®å†…å®¹ã«ã¤ã„ã¦ã‚‚å®Ÿè£…ã‚’æ¤œè¨ãã ã•ã„ã€‚

### iOSã®å¾©å…ƒå‡¦ç†

iOSã®å ´åˆã€å¾©å…ƒãƒœã‚¿ãƒ³ã§ä»¥å‰ã®è³¼å…¥ã‚’å¾©å…ƒã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ä»¥å‰ã«è³¼å…¥ã—ãŸã‹ã©ã†ã‹ã¯`getPurchaseHistoryAsync()`ã§å–å¾—ã§ãã¾ã™ã€‚å¾©å…ƒãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ãŸéš›ã«`getPurchaseHistoryAsync`ã‚’å‘¼ã³å‡ºã—ã€éå»ã®è³¼å…¥å±¥æ­´ãŒå­˜åœ¨ã—ãŸã‚‰æ©Ÿèƒ½ç­‰ã‚’ä»˜ä¸ã™ã‚‹å½¢ã«ã™ã‚Œã°ã‚ˆã„ã¨æ€ã„ã¾ã™ã€‚

### iOSã§è³¼å…¥ãŒä¸­æ–­ã•ã‚ŒãŸå ´åˆã®å‡¦ç†

iOSã§ã€è³¼å…¥æ™‚ã«è¦ç´„ãŒå¤‰æ›´ç­‰ã•ã‚Œã¦åŒæ„ãŒå¿…è¦ã ã£ãŸã‚Šã—ãŸå ´åˆã€ä¸­æ–­ã•ã‚Œã¾ã™ã€‚ãã®å ´åˆã€purchaseListenerã§ã®responseCodeã¯é€šå¸¸æ™‚ã¨ç•°ãªã‚‹å€¤ãŒæ¥ã‚‹ãŸã‚ã€ä¸€åº¦ãã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§æ¤œè¨¼ã™ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚AppStore Connectã§Sandboxã®ãƒ†ã‚¹ã‚¿ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®è¨­å®šã§"ã“ã®ãƒ†ã‚¹ã‚¿ãƒ¼ã®è³¼å…¥ã‚’ä¸­æ–­ã™ã‚‹" ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ONã«ã™ã‚‹ã¨ä¸­æ–­ã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚

### Androidã§ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰è³¼å…¥ã®æ‰¿èªãŒå¿…è¦ãªå ´åˆ

Androidã§è³¼å…¥æ™‚ã«æ‰¿èªãŒå¿…è¦ãªã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ãŒä½¿ã‚ã‚ŒãŸå ´åˆã€æ™‚é–“å·®ã§è³¼å…¥ãŒç¢ºå®šã™ã‚‹ãŸã‚æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚ãƒ†ã‚¹ãƒˆã‚«ãƒ¼ãƒ‰ã‚’ä½¿ãˆã°è©¦ã™ã“ã¨ãŒã§ãã¾ã™ã€‚å´ä¸‹ã•ã‚Œã‚‹å ´åˆã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚å­˜åœ¨ã—ã¾ã™ã€‚

### ãƒ¬ã‚·ãƒ¼ãƒˆã€è³¼å…¥ãƒˆãƒ¼ã‚¯ãƒ³ã®æ¤œè¨¼

è³¼å…¥ã—ãŸãƒ¬ã‚·ãƒ¼ãƒˆãŒæ­£å¸¸ãªã‚‚ã®ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã§ä¸æ­£ãªè³¼å…¥ã‚’é˜²æ­¢ã§ãã¾ã™ã€‚

è³¼å…¥ã®è¨¼æ˜ã¨ã—ã¦ã€iOSã®å ´åˆã¯ãƒ¬ã‚·ãƒ¼ãƒˆã€Androidã®å ´åˆã¯è³¼å…¥ãƒˆãƒ¼ã‚¯ãƒ³ãŒç™ºè¡Œã•ã‚Œã¾ã™ã€‚è³¼å…¥æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã§è³¼å…¥ãƒ¬ã‚³ãƒ¼ãƒ‰ã‹ã‚‰å–å¾—ã§ãã¾ã™ã€‚è³¼å…¥ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’`purchase`ã¨ã—ãŸå ´åˆã€iOSã®å ´åˆã¯`purchase.transactionReceipt`ã€Androidã®å ´åˆã¯`purchase.purchaseToken`ã§å–å¾—ã§ãã¾ã™ã€‚

ã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰ã§æ¤œè¨¼ã™ã‚‹ãŸã‚ã®APIã‚’ç”¨æ„ã—ã¦ãŠãã€è³¼å…¥ç›´å¾Œã‚„ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã®ãŒã‚ˆã„ã¨æ€ã„ã¾ã™ã€‚

å‚è€ƒ:
- [App Storeã‚’ä½¿ç”¨ã—ã¦ãƒ¬ã‚·ãƒ¼ãƒˆã‚’æ¤œè¨¼ã™ã‚‹ - æ—¥æœ¬èªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ - Apple Developer](https://developer.apple.com/jp/documentation/storekit/in-app_purchase/validating_receipts_with_the_app_store/)
- [ã‚µãƒ¼ãƒãƒ¼ã‚’ç”¨ã„ãŸAndroidã®ãƒ¬ã‚·ãƒ¼ãƒˆæ¤œè¨¼ - WonderPlanet Developersâ€™ Blog](https://developers.wonderpla.net/entry/2021/06/04/140228)


## OTA Updateã‚’è¡Œã†å ´åˆã®æ³¨æ„

EAS Buildã®å ´åˆã€OTA Updateã‚’å®Ÿæ–½ã™ã‚‹éš›ã«ã¯æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚

OTA Updateã¯JSã®ã‚³ãƒ¼ãƒ‰ã®ã¿ã—ã‹ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ãªã„ãŸã‚ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤‰ã‚ã£ãŸã‚Šã—ã¦ãƒ©ãƒ³ã‚¿ã‚¤ãƒ å´ã¨ã®äº’æ›æ€§ãŒåˆã‚ãªã„JSã‚³ãƒ¼ãƒ‰ã‚’åæ˜ ã—ã¦ã—ã¾ã†ã¨ä¸å…·åˆã‚„ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã™ã‚‹ã“ã¨ãŒã‚ã‚Šå¾—ã¾ã™ã€‚

ä»Šã¾ã§ã®Classicãƒ“ãƒ«ãƒ‰ã§ã¯ã€ãƒ©ãƒ³ã‚¿ã‚¤ãƒ éƒ¨åˆ†ã¯Expoã®SDKãŒãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã•ã‚Œãªã„é™ã‚Šæ›´æ–°ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸãŒã€EAS Buildã§ã‚¢ãƒ—ãƒªãƒã‚¤ãƒŠãƒªã‚’ç‹¬è‡ªã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸåˆ†ã€ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã¨äº’æ›æ€§ã®åˆã‚ãªã„JSã‚³ãƒ¼ãƒ‰ã‚’publishã—ã¦ã—ã¾ã†ãƒªã‚¹ã‚¯ãŒå‡ºã¦ãã¾ã™ã€‚Expoã§ã¯æ–°ã—ã„ãƒã‚¤ãƒŠãƒªã‚’ä½œæˆã™ã‚‹ã”ã¨ã«release channelåã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¦ã„ã¾ã™ã€‚[Over-the-air updates - Expo Documentation](https://docs.expo.dev/build/updates/#updating-managed-apps-built-with-eas-build)

ã¾ãŸã€OTA Updateã«é–¢é€£ã—ã¦EAS Updateã¨ã„ã†ã‚µãƒ¼ãƒ“ã‚¹ã‚’é–‹ç™ºä¸­ã ãã†ã§ã™(ç¾åœ¨ã‚¯ãƒ­ãƒ¼ã‚ºãƒ‰alpha)ã€‚
[fyi/eas-update.md at master Â· expo/fyi](https://github.com/expo/fyi/blob/master/eas-update.md)


## çµ‚ã‚ã‚Šã«

Ejectã›ãšã«ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’å®Ÿè£…ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã“ã¨ã¯ã‹ãªã‚Šå¤§ããªå‡ºæ¥äº‹ã ã¨æ€ã„ã¾ã™ã€‚

ä»Šã¾ã§ã¯ã€ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚„ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„Nativeãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå¿…è¦ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å ´åˆã€Ejectã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€Expoã®ãƒ¡ãƒªãƒƒãƒˆã‚’æœ€å¤§é™æ´»ã‹ã™ã“ã¨ãŒã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ãã‚ŒãŒExpoã‚’ä½¿ã‚ãªã„ç†ç”±ã«ãªã£ãŸã‚Šã€å¼•ã„ã¦ã¯React Nativeã‚’å°å…¥ã—ãªã„ç†ç”±ã«ãªã‚‹ã‚±ãƒ¼ã‚¹ã‚‚å¤šã‹ã£ãŸã®ã§ã¯ã¨æ¨æ¸¬ã—ã¾ã™ã€‚

ä»Šå¾Œã€æ–°è¦ã«React Nativeã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å§‹ã‚ã‚‹ã¨ãã¯Expoã®Managed Workflowã‚’ä½¿ã†ã¨ã„ã†é¸æŠè‚¢ãŒå¢—ãˆã¦ã„ãã®ã§ã¯ãªã„ã‹ã¨æ€ã„ã¾ã™ã€‚
