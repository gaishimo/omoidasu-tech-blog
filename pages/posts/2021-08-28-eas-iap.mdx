import { parse, parseISO } from "date-fns"
import { PostLayout } from "../../components/PostLayout"
import { ImageWrapper } from "../../components/atoms/ImageWrapper"
export const meta = {
  title: "Expoã®Managed Workflowã§ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’å®Ÿè£…ã™ã‚‹",
  tagNames: ["expo", "react-native", "eas"],
  color1: "rgb(50, 50, 50)",
  color2: "rgb(200, 200, 200)",
  createdAt: parse(
    "2021-08-28 12:00:00 +09:00",
    "yyyy-MM-dd HH:mm:ss XXX",
    new Date(),
  ),
  author: "@gaishimo",
  description:
    "Expoã®EAS Buildã§ã€Managed Workflowãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’å®Ÿè£…ã™ã‚‹æ‰‹é †ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚",
  lastUpdatedAt: parse(
    "2021-08-28 12:00:00 +09:00",
    "yyyy-MM-dd HH:mm:ss XXX",
    new Date(),
  ),
}

export const headlines = []

export default props => (
  <PostLayout headlines={headlines} meta={meta}>
    {props.children}
  </PostLayout>
)

## æ¦‚è¦

ã“ã®è¨˜äº‹ã§ã¯ã€Expoã®Managedãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’å®Ÿè£…ã™ã‚‹æ‰‹é †ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯[expo-in-app-purchases](https://docs.expo.dev/versions/latest/sdk/in-app-purchases/)ã‚’ä½¿ã„ã¾ã™ã€‚

### å‰æ

- Expo SDK: 42
- expo-in-app-purchase: 10.2.0
- èª²é‡‘ã‚¢ã‚¤ãƒ†ãƒ : éæ¶ˆè€—å‹(ä¸€åº¦é™ã‚Šè³¼å…¥ã™ã‚‹ã‚‚ã®)


## ä»¥å‰ã®Classic Buildã§ã¯Ejectã™ã‚‹å¿…è¦ãŒã‚ã£ãŸ

å¾“æ¥ã€Expoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’å®Ÿè£…ã™ã‚‹ã«ã¯Ejectã‚’è¡Œã„Bare Workflowã«å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚ã“ã‚Œã¯Expoã®æ—§å½¢å¼ã®ãƒ“ãƒ«ãƒ‰(Classic Build)ã®ä»•çµ„ã¿ã«ã‚ˆã‚‹åˆ¶ç´„ã§ã™ã€‚

Classicãƒ“ãƒ«ãƒ‰ã¯ã€ã‚ã‚‰ã‹ã˜ã‚ä½¿ã„ãã†ãªNativeãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã²ã¨ã¾ã¨ã¾ã‚Šã¨ã—ã¦ç”¨æ„ã—ã¦ãŠãã€ãã‚Œã‚’å…ƒã«ã‚¢ãƒ—ãƒªã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‚’ä½œæˆã™ã‚‹ã¨ã„ã†ä»•çµ„ã¿ã«ãªã£ã¦ã„ã¾ã™ã€‚ãã®ä¸­ã«ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã®æ©Ÿèƒ½ã¯å«ã¾ã‚Œã¦ãŠã‚‰ãšã€ç‹¬è‡ªã«ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã›ã‚“ã€‚ã¾ãŸã€ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’å‹•ä½œã•ã›ã‚‹ã«ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã«ä¸€ã¤ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªã‚¢ãƒ—ãƒªã‚’æŒã¤å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€é–‹ç™ºç”¨ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¢ãƒ—ãƒª(Expo Go)ãŒä¸€ã¤ã—ã‹åˆ©ç”¨ã§ããªã„ãŸã‚ã€é–‹ç™ºæ™‚ã«ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒä»•çµ„ã¿ä¸Šãã‚‚ãã‚‚ã§ããªã„çŠ¶æ…‹ã§ã—ãŸã€‚

Managed WorkflowãŒä½¿ãˆãªã„ã¨Expoã‚’ä½¿ã†åˆ©ç‚¹ãŒã‹ãªã‚Šæãªã‚ã‚Œã¦ã—ã¾ã†ãŸã‚ã€ã“ã®ç‚¹ãŒExpoã‚’é¸ã¶ä¸Šã§ã®ä¸€ã¤ã®ãƒãƒƒã‚¯ã«ãªã£ã¦ã„ãŸã¨æ€ã„ã¾ã™ã€‚


## EAS Buildã§ã‚¢ãƒ—ãƒªå†…èª²é‡‘ãŒå¯èƒ½ã«

ã—ã‹ã—ã€2021å¹´ã«ExpoãŒæä¾›ã‚’é–‹å§‹ã—ãŸ[EAS Build](https://docs.expo.dev/build/introduction/)ã¨ã„ã†ä»•çµ„ã¿ã«ã‚ˆã‚Šã€Managed Workflowã§ã‚ã£ã¦ã‚‚ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’çµ„ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

EAS Buildã¯Classic Buildã¨ç•°ãªã‚Šç‹¬è‡ªã®Nativeãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚EAS Buildã®ä»•çµ„ã¿ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®å…¬å¼ãƒ–ãƒ­ã‚°ã®è¨˜äº‹ãŒå‚è€ƒã«ãªã‚Šã¾ã™ã€‚
[Expo managed workflow in 2021. Part 2: Customizing the runtime | by Brent Vatne | Exposition](https://blog.expo.dev/expo-managed-workflow-in-2021-d1c9b68aa10)

æ›´ã«ã€Custom Development Clientsã¨ã„ã†ã‚‚ã®ã‚’ãƒ“ãƒ«ãƒ‰ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã“ã‚Œã¯ã€é–‹ç™ºç”¨ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ç‹¬è‡ªã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ãƒ“ãƒ«ãƒ‰ãƒ»å†…éƒ¨é…å¸ƒã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šé–‹ç™ºæ™‚ã«ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã®æ©Ÿèƒ½ã‚’åˆ©ç”¨ãƒ»æ¤œè¨¼ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚
[Introducing: Custom Development Clients | by TC Davis | Jul, 2021 | Exposition](https://blog.expo.dev/introducing-custom-development-clients-5a2c79a9ddf8)


ã“ã‚Œã‚‰ã®æ©Ÿèƒ½ã¯2021å††8æœˆæ™‚ç‚¹ã§ã¯ã¾ã Previewã®ãŸã‚ã€åˆ©ç”¨ã™ã‚‹ã«ã¯[Priorityãƒ—ãƒ©ãƒ³(æœˆ29ãƒ‰ãƒ«)](https://expo.dev/pricing)ã«åŠ å…¥ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚([Previewã¯ãƒ™ãƒ¼ã‚¿ç‰ˆã®ã‚ˆã†ãªä½ç½®ã¥ã‘ã¨ã¯ç•°ãªã‚Šã€ãƒ¦ãƒ¼ã‚¶ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å—ã‘ã‚‹ãŸã‚ã®æœŸé–“ã¨ã®ã“ã¨ã§ã™](https://docs.expo.dev/feature-preview/#what-does-feature-preview-mean))


å¼Šç¤¾ã®[Simpluna](https://apps.apple.com/jp/app/id1528652349?ign-itsct=apps_box&ign-itscg=30200)ã¨ã„ã†ã‚¢ãƒ—ãƒª(iOS & Android)ã§ã¯ã€EAS Buildã‚’åˆ©ç”¨ã—ã¦2021å¹´7æœˆã‹ã‚‰ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’æä¾›ã—ã¦ã„ã¾ã™ãŒã€ç‰¹ã«å•é¡Œãªãå‹•ä½œã—ã¦ã„ã¾ã™ã€‚

Simplunaã‚’åˆå›ãƒªãƒªãƒ¼ã‚¹ã—ãŸæ™‚ç‚¹(2020å¹´8æœˆ)ã§ã¯ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’å°å…¥ã™ã‚‹ã«ã¯Ejectã™ã‚‹ã—ã‹ãªã„çŠ¶æ…‹ã§ã—ãŸãŒã€è¿‘ã„ã†ã¡ã«Managed Workflowã§ã‚‚ã‚µãƒãƒ¼ãƒˆã•ã‚Œãã†ã ã£ãŸã®ã§ã€æœ€åˆã¯ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’å«ã‚ãšã«ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚ç„¡æ–™ã®ã¿ã§ãƒ¦ãƒ¼ã‚¶ã‚’å¢—ã‚„ã—æ”¹å–„ã—ã¦ã„ããªãŒã‚‰ã€ã‚¢ãƒ—ãƒªå†…èª²é‡‘ãŒã‚µãƒãƒ¼ãƒˆã•ã‚ŒãŸæ™‚ç‚¹ã§å°å…¥ã™ã‚‹ã¨ã„ã†è¨ˆç”»ã§ã™ã€‚1å¹´ã»ã©çµŒã£ã¦ã¤ã„ã«EAS BuildãŒæä¾›ã•ã‚ŒãŸãŸã‚ã€2021å¹´7æœˆã«å°å…¥ã—ãŸã¨ã„ã†æµã‚Œã«ãªã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã§ã¯ã€å®Ÿéš›ã«ã©ã®ã‚ˆã†ã«å°å…¥ã—ã¦ã„ãã‹ã‚’èª¬æ˜ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚


## expo-in-app-purchasesã®è¿½åŠ 

å®Ÿè£…ã¯[expo-in-app-purchases](https://www.npmjs.com/package/expo-in-app-purchases)ã‚’ä½¿ã£ã¦è¡Œã„ã¾ã™ã€‚ã¾ãšé€šå¸¸é€šã‚Šãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’package.jsonã«è¿½åŠ ã—ã¾ã™ã€‚

```
yarn add expo-in-app-purchases
```

â€»npmã®å ´åˆã¯éšæ™‚å¤‰æ›´ã—ã¦ãã ã•ã„

ã‚‚ã—ã‚‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®è¨­å®šã§Nativeéƒ¨åˆ†ã«é–¢é€£ã™ã‚‹ä¿®æ­£(iosãƒ•ã‚©ãƒ«ãƒ€ãƒ»androidãƒ•ã‚©ãƒ«ãƒ€å†…ã§ç™ºç”Ÿã™ã‚‹ä¿®æ­£)ãŒå¿…è¦ãªå ´åˆã¯[Config Plugin](https://docs.expo.dev/guides/config-plugins/)ã‚’åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã™ãŒã€expo-in-app-purchasesã«é–¢ã—ã¦ã¯ãƒã‚¤ãƒ†ã‚£ãƒ–å›ºæœ‰ã®è¨­å®šã¯å¿…è¦ãªã„ãŸã‚ä¸è¦ã§ã™ã€‚



## AppStoreãƒ»Google Playã®è¨­å®š

ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ã€äº‹å‰ã«AppStoreã¨Google Playã®è¨­å®šã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

æ‰‹é †ã¯[InAppPurchasesã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.expo.dev/versions/latest/sdk/in-app-purchases/#setup) ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹é€šã‚Šãªã®ã§ã™ãŒã€iOSã®In-App Purhchaseã®Capabilityã®è¨­å®šã¯è‡ªå‹•ã§è¡Œã‚ã‚Œã‚‹ãŸã‚ç‰¹ã«è¨­å®šã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

Google Playã«ã¤ã„ã¦ã¯ã€ä¸€åº¦ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å«ã‚€çŠ¶æ…‹ã§ã‚¢ãƒ—ãƒªã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‚’ä½œæˆã—ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã†ã—ãªã„ã¨èª²é‡‘ã‚¢ã‚¤ãƒ†ãƒ ã®è¨­å®šãŒã§ãã¾ã›ã‚“ã€‚ä»Šå›ã®æ‰‹é †ã§ã¯å¾Œã§ãƒ“ãƒ«ãƒ‰ã‚’ä½œæˆã™ã‚‹ãŸã‚ã€ä¸€æ—¦å¾Œå›ã—ã«ã—ã¦å¤§ä¸ˆå¤«ã§ã™ã€‚


## Development Clientã®ãƒ“ãƒ«ãƒ‰

ä»Šã®çŠ¶æ…‹ã§expo-in-app-purchasesã‚’ç”¨ã„ã¦ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã—ã¦ã‚‚ã€Expo Goã‚¢ãƒ—ãƒªã§ã¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã—ã¾ã„ã¾ã™ã€‚ã“ã‚Œã¯Expo Goã‚¢ãƒ—ãƒªã§ã¯expo-in-app-purchasesã®Runtime(Native Module)ãŒæä¾›ã•ã‚Œã¦ã„ãªã„ãŸã‚ã§ã™ã€‚

ã“ã®ã¾ã¾ã§ã¯Expo Goã§ã¯é–‹ç™ºãŒã§ããªã„ãŸã‚ã€expo-in-app-purhcasesã‚’å«ã‚“ã ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¢ãƒ—ãƒª(DevClient)ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚

DevClientã¯ä½œæˆã›ãšã«é€šå¸¸ã®ãƒ“ãƒ«ãƒ‰(aab, ipa)ã‚’ç”Ÿæˆã—ã¦ç«¯æœ«ã«ã‚¢ãƒ—ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’æ¤œè¨¼ã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚‹ã¨æ€ã„ã¾ã™ãŒã€ãã®å ´åˆé–‹ç™ºã—ãªãŒã‚‰èª²é‡‘ã‚’æ¤œè¨¼ã™ã‚‹ã¨ã„ã†ã“ã¨ãŒã§ããšé–‹ç™ºåŠ¹ç‡ãŒæ‚ªããªã‚Šã¾ã™ã€‚ã¾ãŸExpo Goã®å ´åˆã¯expo-in-app-purchasesã‚’importã—ãªã„ã‚ˆã†ã«ã™ã‚‹ç­‰ã®å¯¾å¿œãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚è«¸ã€…æ‰‹é–“ãŒã‹ã‹ã‚‹ãŸã‚ã€DevClientã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚


### expo-dev-clientã®è¿½åŠ 

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«expo-dev-clientãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```
yarn add expo-dev-client
```

ã‚¢ãƒ—ãƒªã®ã‚³ãƒ¼ãƒ‰ãƒˆãƒƒãƒ—(App.tsx) ã«expo-dev-clientã®importã‚’è¿½åŠ ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€DevClientä¸Šã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚ã‹ã‚Šã‚„ã™ãè¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã™ã‚‹ãŸã‚ã§ã™ã€‚

```
import "expo-dev-client"
```


[Getting Started - Expo Documentation](https://docs.expo.dev/clients/getting-started/)



### EASã®è¨­å®š

EASãƒ“ãƒ«ãƒ‰ãŒã§ãã‚‹ã‚ˆã†ã«eas.jsonã‚’ç”Ÿæˆã—ã¾ã™ã€‚äº‹å‰ã«eas-cliã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦ã§ã™(`npm install -g eas-cli`)ã€‚

```bash
$ eas build::configure
 â€º   Error: command build::configure not found
gaishimo@dev01:~/workspace/expo-iap-example$ eas build:configure
ğŸ’¡ The following process will configure your iOS and/or Android project to be compatible with EAS Build. These changes only apply to your local project files and you can safely revert them at any time.

âœ” Which platforms would you like to configure for EAS Build? â€º All

âœ” Generated eas.json

ğŸ“  Android application id Learn more: https://expo.fyi/android-package
âœ” What would you like your Android application id to be? â€¦ com.gaishimo.example1

ğŸ“  iOS Bundle Identifier Learn more: https://expo.fyi/bundle-identifier
âœ” What would you like your iOS bundle identifier to be? â€¦ com.gaishimo.example1

âœ” Can we commit these changes to git for you? â€º Yes
âœ” Commit message: â€¦ Configure EAS Build
âœ” Committed changes

ğŸ‰ Your iOS and Android projects are ready to build.

- Run eas build when you are ready to create your first build.
- Once the build is completed, run eas submit to upload the app to the Apple App Store or Google Play Store
- Learn more about other capabilities of EAS Build: https://docs.expo.dev/build/introduction
```

ä»¥ä¸‹ã®å†…å®¹ã§eas.jsonãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚
```json
{
  "build": {
    "release": {},
    "development": {
      "developmentClient": true,
      "distribution": "internal"
    }
  }
}
```

`release`ã¨å…±ã« `development` ã¨ã„ã†profileåã®è¨­å®šãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚`"developmentClient": true`ã¯é–‹ç™ºã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”¨ã®ãƒ“ãƒ«ãƒ‰ã§ã‚ã‚Šã€`"distribution": "internal"`ã¯å†…éƒ¨é…å¸ƒã§ã‚ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚

ã¾ãŸã€åŒæ™‚ã«app.jsonã«Bundle ID(ios)ã€packageå(android)ãŒä»˜ä¸ã•ã‚Œã¾ã™ã€‚

### Adhocã®è¨­å®š

iOSã®å ´åˆã€Development Clientã‚’å†…éƒ¨é…å¸ƒã™ã‚‹ã«ã¯ã€ad hoc provisioning profileã«å¯¾ã—ã¦ç«¯æœ«ã®UDIDã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚


`eas device:create` ã‚’å®Ÿè¡Œã—ã€

```
$ eas device:create
This command lets you register your Apple devices (iPhones and iPads) for internal distribution of your app.
Internal distribution means that you won't need upload your app archive to App Store / Testflight.
Your app archive (.ipa) will be installable on your equipment as long as you sign your application with an adhoc provisiong profile.
The provisioning profile needs to contain the UDIDs (unique identifiers) of your iPhones and iPads.

First of all, please choose the Expo account under which you want to register your devices.
Later, authenticate with Apple and choose your desired Apple Team (if your Apple ID has access to multiple teams).

âœ” You're inside the project directory. Would you like to use gaishimo-omoidasu account? â€¦ yes
â€º Log in to your Apple Developer account to continue
âœ” Apple ID: â€¦ <çœç•¥>
â€º Restoring session /home/gaishimo/.app-store/auth/<çœç•¥>/cookie
â€º Session expired Local session
â€º The password is only used to authenticate with Apple and never stored on EAS servers
  Learn more: https://bit.ly/2VtGWhU
âœ” Password (for <çœç•¥>): â€¦ ********************
â€º Saving Apple ID password to the local Keychain
  Learn more: https://docs.expo.io/distribution/security#keychain
âœ” Logged in New session
â€º Team <çœç•¥> (<çœç•¥> )
â€º Provider <çœç•¥>  (<çœç•¥> )
âœ” How would you like to register your devices? â€º Website - generates a registration URL to be opened on your devices

[QR Code]

Open the following link on your iOS devices (or scan the QR code) and follow the instructions to install the development profile:

https://expo.io/register-device/<çœç•¥>
```

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ä¸Šã«QRã‚³ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãŸã‚ãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰QRã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã€Provisioning Profileã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ»ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚



### EAS Buildã®å®Ÿè¡Œ

è¨­å®šãŒå®Œäº†ã—ãŸã‚‰ã€Development Clientã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦ã¿ã¾ã™ã€‚
```
$ eas build --platform all --profile development
âœ” Created @gaishimo-omoidasu/expo-iap-example (https://expo.dev/accounts/gaishimo-omoidasu/projects/expo-iap-example) on Expo
âœ” Using remote Android credentials (Expo server)
âœ” Generate a new Android Keystore? â€¦ yes
âœ” Created keystore
âœ” Compressed project files 17s (206 MB)
âœ” Uploaded to EAS 11s Learn more: https://expo.fyi/eas-build-archive
âœ” Linked to project @gaishimo-omoidasu/expo-iap-example (https://expo.dev/accounts/gaishimo-omoidasu/projects/expo-iap-example)
âœ” Using remote iOS credentials (Expo server)

If you provide your Apple account credentials we will be able to generate all necessary build credentials and fully validate them.
This is optional, but without Apple account access you will need to provide all the values manually and we can only run minimal validation on them.
âœ” Do you want to log in to your Apple account? â€¦ yes

â€º Log in to your Apple Developer account to continue
âœ” Apple ID: â€¦ gaithimo@gmail.com
â€º Restoring session /home/gaishimo/.app-store/auth/gaithimo@gmail.com/cookie
â€º Session expired Local session
â€º The password is only used to authenticate with Apple and never stored on EAS servers
  Learn more: https://bit.ly/2VtGWhU
âœ” Password (for gaithimo@gmail.com): â€¦ **********
â€º Saving Apple ID password to the local Keychain
  Learn more: https://docs.expo.dev/distribution/security#keychain
âœ” Logged in New session
â€º Team Omoidasu, Inc. (UF2VN9TFY6)
â€º Provider Omoidasu, Inc. (119036950)
âœ” Bundle identifier registered com.gaishimo.example1
âœ” Synced capabilities: No updates
âœ” Synced capability identifiers: No updates
âœ” Fetched Apple distribution certificates
âœ” Reuse this distribution certificate?
Cert ID: FPB55CX4MG, Serial number: 5B5C85FC8B1D146808E78E505C5BB366, Team ID: UF2VN9TFY6, Team name: Omoidasu, Inc. (Company/Organization)
    Created: 5 days ago, Updated: 5 days ago,
    Expires: Tue, 23 Aug 2022 00:17:32 GMT+0000
    ğŸ“² Used by: @gaishimo-omoidasu/simpluna-alpha,@gaishimo-omoidasu/simpluna,@gaishimo-omoidasu/simpluna-alpha-dev â€¦ yes
Using distribution certificate with serial number 5B5C85FC8B1D146808E78E505C5BB366
âœ” Select devices for the adhoc build: â€º 00008030-000161CC36DA802E (iPhone 11 Pro), 00008030-001818D20290802E (iPhone 11 Pro), 561b611b1abb78b72c16d6517323d5ec96b4e61e (iPhone 7), bf1a0d03c683c91648a80b2cdc6515e407197d8d (iPhone SE (gen 1))
âœ” Created new profile: *[expo] com.gaishimo.example1 AdHoc 1630121320983

Project Credentials Configuration:
  Project: @gaishimo-omoidasu/expo-iap-example
  Bundle Identifier: com.gaishimo.example1
  Configuration: Ad Hoc

  Distribution Certificate:
    Serial Number: 5B5C85FC8B1D146808E78E505C5BB366
    Expiration Date: Tue, 23 Aug 2022 00:17:32 GMT+0000
    Apple Team: UF2VN9TFY6 (Omoidasu, Inc. (Company/Organization))
    Updated 5 days ago

  Provisioning Profile:
    Developer Portal ID: 35S7QF6RJ8
    Status: active
    Expiration Date: Tue, 23 Aug 2022 00:17:32 GMT+0000
    Apple Team: UF2VN9TFY6 (Omoidasu, Inc. (Company/Organization))
    Provisioned devices:
    - iPhone 11 Pro (UDID: 00008030-000161CC36DA802E)
    - iPhone 11 Pro (UDID: 00008030-001818D20290802E)
    - iPhone 7 (UDID: 561b611b1abb78b72c16d6517323d5ec96b4e61e)
    - iPhone SE (gen 1) (UDID: bf1a0d03c683c91648a80b2cdc6515e407197d8d)
    Updated 2 seconds ago

All credentials are ready to build @gaishimo-omoidasu/expo-iap-example (com.gaishimo.example1)

âœ” Would you like to setup Push Notifications for your project? â€¦ no
âœ” Compressed project files 16s (206 MB)
âœ” Uploaded to EAS 12s Learn more: https://expo.fyi/eas-build-archive

Android build details: https://expo.dev/accounts/gaishimo-omoidasu/builds/a34f947c-809e-46e0-b0f1-44d4fff6e58d
iOS build details: https://expo.dev/accounts/gaishimo-omoidasu/builds/3d4c9882-15a8-47dd-9b37-61f4451110d1

Waiting for builds to complete. You can press Ctrl+C to exit.
```

### DevClientã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ãƒ“ãƒ«ãƒ‰ãŒæˆåŠŸã—ãŸã‚‰ã€ãƒ“ãƒ«ãƒ‰çµæœãƒšãƒ¼ã‚¸ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚QRã‚³ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€iPhoneç«¯æœ«ã§èª­ã¿å–ã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

<ImageWrapper width={180}>
  <img alt="DevClientã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«" src="/posts/2021-08-28-eas-iap/install-dev-client-ios.png" width="100%" height="auto" />
</ImageWrapper>

### DevClientã®èµ·å‹•

DevClientã‚’ç«¯æœ«ä¸Šã§èµ·å‹•ã—ã¦ã¿ã¾ã™ã€‚

ã¾ãšã‚µãƒ¼ãƒã‚’èµ·å‹•ã—ã¾ã™ã€‚expo startã®éš›ã«`--dev-client`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¦èµ·å‹•ã—ã¾ã™ã€‚
```
expo start --dev-client
```

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ä¸Šã«QRã‚³ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãŸã‚ã€ã‚«ãƒ¡ãƒ©ã§QRã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã‚‹ã¨ã€ç„¡äº‹Dev ClientãŒèµ·å‹•ã—ã¾ã—ãŸ!

<ImageWrapper width={240}>
  <img alt="DevClientã‚’èµ·å‹•" src="/posts/2021-08-28-eas-iap/dev-client-run-ios.jpeg" width="100%" height="auto" />
</ImageWrapper>


## ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã®å®Ÿè£…

é–‹ç™ºç”¨ã®ç’°å¢ƒãŒæ•´ã£ãŸã®ã§ã€expo-in-app-purhchasesã‚’ç”¨ã„ã¦ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã®å®Ÿè£…ã‚’ã—ã¾ã™ã€‚æœ€ä½é™ã®ã‚¢ã‚¤ãƒ†ãƒ è³¼å…¥ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã®ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¾ã™ã€‚

ä»¥ä¸‹ãŒã‚³ãƒ¼ãƒ‰ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚

```
TODO
```

ç”»é¢ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«è³¼å…¥ãƒœã‚¿ãƒ³ã®ã¿ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
<ImageWrapper width={240}>
  <img alt="è³¼å…¥ç”¨ç”»é¢" src="/posts/2021-08-28-eas-iap/purchase-screen.jpeg" width="100%" height="auto" />
</ImageWrapper>

iOSã®å ´åˆã€è³¼å…¥æ™‚ã«Apple IDã§ã®ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚’æ±‚ã‚ã‚‰ã‚Œã‚‹ãŸã‚ã€AppStore Connectã§ä½œæˆã—ãŸSandboxã®ãƒ†ã‚¹ã‚¿ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã¨ã€OSã®è³¼å…¥ç”¨ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãŸã‚ã€å†åº¦Sandboxã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

<ImageWrapper width={240}>
  <img alt="è³¼å…¥ç”¨ç”»é¢" src="/posts/2021-08-28-eas-iap/purchase-ios.jpeg" width="100%" height="auto" />
</ImageWrapper>

Sandboxç’°å¢ƒã®å ´åˆOSã®è³¼å…¥ç”¨ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒ2åº¦è¡¨ç¤ºã•ã‚Œã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã¯Sandboxç’°å¢ƒã®ã¿ã®ç¾è±¡ã®ãŸã‚æœ¬ç•ªç’°å¢ƒã§ã¯ç‰¹ã«å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

è³¼å…¥ãŒç„¡äº‹å®Œäº†ã™ã‚‹ã¨ã€å®Œäº†ã®ã‚¢ãƒ©ãƒ¼ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
<ImageWrapper width={240}>
  <img alt="è³¼å…¥ç”¨ç”»é¢" src="/posts/2021-08-28-eas-iap/purchased-ios.png" width="100%" height="auto" />
</ImageWrapper>

## Androidã§ã®å‹•ä½œç¢ºèª


### ã‚¹ãƒˆã‚¢ç”¨ãƒ“ãƒ«ãƒ‰ã®ä½œæˆãƒ»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

Androidã®å ´åˆã€Google Playã§ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã®è¨­å®šã‚’ã™ã‚‹ã®ã«ã€ä¸€åº¦ã‚¢ãƒ—ãƒªã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦ã‚¹ãƒˆã‚¢ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

eas:configure ã—ãŸéš›ã«ä½œæˆã•ã‚ŒãŸrelease profileã§androidã®ãƒ“ãƒ«ãƒ‰ã‚’è¡Œã„ã¾ã™ã€‚

```
eas build --platform android --profile release
```

ãƒ“ãƒ«ãƒ‰ãŒæˆåŠŸã™ã‚‹ã¨ã€ãƒ“ãƒ«ãƒ‰çµæœç”»é¢ã‹ã‚‰aabãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ãŸã‚ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚ä¸€åº¦ä½•ã‚‰ã‹ã®å½¢ã§èª²é‡‘æ©Ÿèƒ½ãŒå«ã¾ã‚ŒãŸaabã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚Œã°ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã®ç”»é¢ã¯è¨­å®šå¯èƒ½ã«ãªã‚‹ãŸã‚ã€å†…éƒ¨ãƒ†ã‚¹ãƒˆãƒªãƒªãƒ¼ã‚¹ç­‰ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚(ãƒªãƒªãƒ¼ã‚¹è‡ªä½“ã¯å¿…ãšã—ã‚‚å…¬é–‹ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“)

èª²é‡‘ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ ã—ãŸç›´å¾Œã¯ã¾ã ã€ã‚¢ãƒ—ãƒªã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ä¸Šã‹ã‚‰ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚’å–å¾—ã§ããªã„ã®ã§ã™(productIdã‚’æŒ‡å®šã—ã¦ã€getProductsAsyncã—ã¦ã‚‚çµæœãŒç©ºã«ãªã‚‹)ãŒã€ã—ã°ã‚‰ãå¾…ã¤ã‹ã€Androidç«¯æœ«ã®è¨­å®šã§ã‚¢ãƒ—ãƒªã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹ã¨å–å¾—ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

Androidä¸Šã§DevClientã‚’èµ·å‹•ã—è³¼å…¥ã‚’è¡Œã†ã¨ã€OSã®è³¼å…¥ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

<ImageWrapper width={240}>
  <img alt="è³¼å…¥ç”¨ç”»é¢" src="/posts/2021-08-28-eas-iap/purchase-screen-android.png" width="100%" height="auto" />
</ImageWrapper>

ãã®ã¾ã¾è‡ªåˆ†ã®ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã§è³¼å…¥ã™ã‚‹ã¨å®Ÿéš›ã«èª²é‡‘ã•ã‚Œã¦ã—ã¾ã†ãŸã‚ã€ã‚¢ãƒ—ãƒªãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’Gmailã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«è¨­å®šã—ã¦è³¼å…¥ã™ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’ä¿æŒã—ã¦ã„ã‚‹Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å ´åˆã€"ãƒ†ã‚¹ãƒˆã‚«ãƒ¼ãƒ‰" ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

[ã‚¢ãƒ—ãƒª ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’ä½¿ç”¨ã—ãŸã‚¢ãƒ—ãƒªå†…èª²é‡‘ã®ãƒ†ã‚¹ãƒˆ - Play Console ãƒ˜ãƒ«ãƒ—](https://support.google.com/googleplay/android-developer/answer/6062777?hl=ja)


## ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã®å®Ÿè£…ã®æ³¨æ„ç‚¹

ä»Šå›ã¯æœ€ä½é™ã€è³¼å…¥ãŒã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ãŸã‹ã£ãŸãŸã‚æœ€ä½é™ã®ã‚³ãƒ¼ãƒ‰ã—ã‹æ›¸ã„ã¦ã„ã¾ã›ã‚“ãŒã€å®Ÿéš›ã«ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã‚’å°å…¥ã™ã‚‹å ´åˆã«ã¯ä»¥ä¸‹ã«ã¤ã„ã¦ã‚‚è¿½åŠ ã‚’æ¤œè¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚

### iOSã®å¾©å…ƒå‡¦ç†

iOSã®å ´åˆã€å¾©å…ƒãƒœã‚¿ãƒ³ã§ä»¥å‰ã®è³¼å…¥ã‚’å¾©å…ƒã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ä»¥å‰ã«è³¼å…¥ã—ãŸã‹ã©ã†ã‹ã¯`getPurchaseHistoryAsync()`ã§å–å¾—ã§ãã¾ã™ã€‚å¾©å…ƒãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ãŸéš›ã«`getPurchaseHistoryAsync`ã‚’å‘¼ã³å‡ºã—ã€éå»ã®è³¼å…¥å±¥æ­´ãŒå­˜åœ¨ã—ãŸã‚‰æ©Ÿèƒ½ç­‰ã‚’ä»˜ä¸ã™ã‚‹å½¢ã«ã™ã‚Œã°ã‚ˆã„ã§ã—ã‚‡ã†ã€‚

### iOSã§è³¼å…¥ãŒä¸­æ–­ã•ã‚ŒãŸå ´åˆã®å‡¦ç†

iOSã§ã€è³¼å…¥æ™‚ã«è¦ç´„ãŒå¤‰æ›´ç­‰ã•ã‚Œã¦åŒæ„ãŒå¿…è¦ã ã£ãŸã‚Šã—ãŸå ´åˆã€ä¸­æ–­ã•ã‚Œã¾ã™ã€‚